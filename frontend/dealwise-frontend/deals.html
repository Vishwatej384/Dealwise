<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DealWise ‚Äî Top Deals</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#0d1117">
  <style>
    /* (kept the same core styles as index.html to preserve theme & animations) */
    :root{ --bg:#0d1117; --card:#0f1720; --muted:#98a0aa; --accent:#00c8ff; --accent-2:#ffc107;
      --glass: rgba(255,255,255,0.04); --glass-border: rgba(255,255,255,0.04); --radius:14px; }
    html,body{ height:100%; margin:0; background:linear-gradient(180deg,#06080b 0%, #0d1117 100%); color:#e6eef6; font-family:"Poppins",sans-serif;}
    header.navbar{ position:sticky; top:0; z-index:60; display:flex; align-items:center; justify-content:space-between; padding:12px 22px; gap:12px; backdrop-filter: blur(6px); background: linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); border-bottom:1px solid rgba(255,255,255,0.03);}
    .brand{ display:flex; gap:12px; align-items:center; }
    nav.nav-center{ display:flex; gap:12px; align-items:center; }
    .nav-link{ color:var(--muted); padding:8px 12px; border-radius:8px; transition: all .22s ease; font-weight:600; font-size:14px; }
    .nav-link:hover{ color:white; background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); transform:translateY(-2px); }
    .nav-link.active{ color:var(--accent); box-shadow: 0 6px 18px rgba(0,200,255,0.06); }
    .nav-right{ display:flex; align-items:center; gap:10px; }
    .search-wrap input{ width:260px; padding:10px 12px; border-radius:10px; background:var(--glass); border:1px solid var(--glass-border); color:#e6eef6; outline:none; }
    .icon-btn{ background:transparent; border:1px solid rgba(255,255,255,0.03); padding:8px 10px; border-radius:10px; cursor:pointer; color:var(--muted); transition: all .18s ease; font-weight:600; }
    .btn-accent{ background: linear-gradient(90deg,var(--accent), #66f0ff); color:#001; padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:700; box-shadow: 0 10px 30px rgba(0,200,255,0.08); }
    main{ padding:28px; max-width:1200px; margin:0 auto; }
    h1{ margin:0 0 6px; }
    .deals-grid{ display:grid; grid-template-columns: repeat(3,1fr); gap:16px; margin-top:12px; }
    .deal-card{ background:var(--card); border-radius:12px; padding:12px; border:1px solid rgba(255,255,255,0.03); transition: transform .18s, box-shadow .18s; position:relative; overflow:hidden; }
    .deal-card img{ width:100%; height:170px; object-fit:cover; border-radius:8px; display:block; }
    .deal-actions{ display:flex; align-items:center; justify-content:space-between; margin-top:12px; gap:10px; }
    .muted{ color:var(--muted); font-size:13px; }
    footer.site-footer{ margin-top:42px; padding:24px; border-top:1px solid rgba(255,255,255,0.03); display:flex; justify-content:space-between; align-items:center; gap:12px; color:var(--muted); }
    #toast{ position:fixed; right:22px; bottom:24px; background:linear-gradient(90deg, rgba(0,0,0,0.6), rgba(12,16,20,0.6)); color:#e6f7ff; padding:12px 16px; border-radius:10px; opacity:0; transform:translateY(12px); transition: all .28s; z-index:9999; }
    #toast.show{ opacity:1; transform:translateY(0); }
    @media(max-width:1000px){ .deals-grid{ grid-template-columns:repeat(2,1fr);} .search-wrap input{width:160px;} }
    @media(max-width:600px){ .deals-grid{ grid-template-columns:1fr;} header.navbar{ flex-direction:column; align-items:flex-start; } .search-wrap input{ width:100%; } }
    .pop-in{ animation: popIn .45s cubic-bezier(.2,.85,.32,1) both; } @keyframes popIn{from{opacity:0; transform:translateY(10px) scale(.995)} to{opacity:1; transform:none}}
  </style>
</head>
<body>
  <header class="navbar pop-in">
    <div class="brand">
      <div style="width:44px; height:44px; border-radius:12px; background:linear-gradient(135deg, #00c8ff, #66f0ff); display:flex; align-items:center; justify-content:center; color:#001; font-weight:800; font-size:18px; box-shadow:0 8px 25px rgba(0,200,255,0.3);">
        DW
      </div>
      <div>
        <div style="font-weight:700">DealWise</div>
        <div style="font-size:12px;color:var(--muted)">Smart Deals ‚Ä¢ Verified</div>
      </div>
    </div>

    <nav class="nav-center">
      <a class="nav-link" href="index.html">Home</a>
      <a class="nav-link" href="categories.html">Categories</a>
      <a class="nav-link active" href="deals.html">Top Deals</a>
      <a class="nav-link" href="purchase-history.html">History</a>
      <a class="nav-link" href="about.html">About</a>
      <a class="nav-link" href="contact.html">Contact</a>
    </nav>

    <div class="nav-right">
      <div class="search-wrap"><input id="searchInput" placeholder="Search deals..." /></div>
      <button id="cartButton" class="icon-btn">üõçÔ∏è <span id="cartCount" class="cart-count" style="margin-left:8px;background:linear-gradient(90deg,#00c8ff,#66f0ff);color:#001;padding:2px 8px;border-radius:999px;font-weight:700">0</span></button>
      <button id="loginBtn" class="icon-btn">Login</button>
      <button id="signupBtn" class="btn-accent">Sign Up</button>
    </div>
  </header>

  <main>
    <h1>üî• Top Deals</h1>
    <p class="muted">Hand-picked deals ‚Äî click View to open the product page, Add to add to cart.</p>
    <div id="dealsGrid" class="deals-grid"></div>
  </main>

  <footer class="site-footer">
    <div style="display:flex;gap:12px;align-items:center">
      <svg width="30" height="30"><rect width="30" height="30" rx="6" fill="#00c8ff" opacity="0.12"/></svg>
      <div><div style="font-weight:700">DealWise</div><div style="color:var(--muted);font-size:13px">¬© 2025 DealWise</div></div>
    </div>
    <div style="color:var(--muted)"><a href="index.html">Home</a> ‚Ä¢ <a href="categories.html">Categories</a></div>
  </footer>

  <div id="toast" role="status" aria-live="polite"></div>

  <script src="js/global.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/shared.js"></script>
  <script src="js/features.js"></script>
  <script src="js/chatbot.js"></script>
  <script>
    // Shared small runtime (same logic as index but scoped)
    const API_BASE = 'http://localhost:8080/api';
    const SAMPLE_DEALS = [
      { id: 'd1', title: 'Wireless Headphones', price: '‚Çπ2,499', note: '30% off', img: 'https://images.unsplash.com/photo-1585386959984-a4155223f8a2?auto=format&fit=crop&w=1000&q=80' },
      { id: 'd2', title: 'Smartwatch Series 6', price: '‚Çπ8,999', note: '25% off', img: 'https://images.unsplash.com/photo-1516574187841-cb9cc2ca948b?auto=format&fit=crop&w=1000&q=80' },
      { id: 'd3', title: 'RGB Gaming Keyboard', price: '‚Çπ1,799', note: '40% off', img: 'https://images.unsplash.com/photo-1606813902829-65e5484d7331?auto=format&fit=crop&w=1000&q=80' },
      { id: 'd4', title: 'Bluetooth Speaker', price: '‚Çπ1,299', note: '35% off', img: 'https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?auto=format&fit=crop&w=1000&q=80' },
      { id: 'd5', title: 'Wireless Mouse', price: '‚Çπ899', note: '20% off', img: 'https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?auto=format&fit=crop&w=1000&q=80' },
      { id: 'd6', title: '4K Smart TV', price: '‚Çπ49,999', note: '15% off', img: 'https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?auto=format&fit=crop&w=1000&q=80' }
    ];
    // current deals cache for add-to-cart lookups
    window.currentDeals = [...SAMPLE_DEALS];

    const CART_KEY = 'dealwise_cart';
    function readCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY)||'[]') }catch(e){return[]} }
    function writeCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); updateCartUI(); }
    function updateCartUI(){ const el = document.getElementById('cartCount'); el.textContent = readCart().reduce((s,i)=> s + (i.qty||1), 0); const btn=document.getElementById('cartButton'); btn.classList.add('glow'); setTimeout(()=>btn.classList.remove('glow'),700); }

    function showToast(msg, t=1300){ const tEl = document.getElementById('toast'); tEl.textContent=msg; tEl.classList.add('show'); clearTimeout(window._to); window._to=setTimeout(()=>tEl.classList.remove('show'),t); }

    function getCategoryImage(category) {
      const images = {
        electronics: 'https://images.unsplash.com/photo-1498049794561-7780e7231661?auto=format&fit=crop&w=1000&q=80',
        fashion: 'https://images.unsplash.com/photo-1445205170230-053b83016050?auto=format&fit=crop&w=1000&q=80',
        home: 'https://images.unsplash.com/photo-1556911220-bff31c812dba?auto=format&fit=crop&w=1000&q=80',
        fitness: 'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&w=1000&q=80',
        gaming: 'https://images.unsplash.com/photo-1542751371-adc38448a05e?auto=format&fit=crop&w=1000&q=80',
        beauty: 'https://images.unsplash.com/photo-1596462502278-27bfdc403348?auto=format&fit=crop&w=1000&q=80'
      };
      return images[category] || 'https://images.unsplash.com/photo-1498049794561-7780e7231661?auto=format&fit=crop&w=1000&q=80';
    }

    function addToCartId(id, btn){
      const list = (window.currentDeals && window.currentDeals.length) ? window.currentDeals : SAMPLE_DEALS;
      const deal = list.find(d=>String(d.id)===String(id)); 
      if(!deal) { return; }
      if (window.dealwiseCart) {
        window.dealwiseCart.addToCart({ id: deal.id, title: deal.title, price: deal.price, note: deal.note, img: deal.img });
      }
    }

    function renderDeals(deals){
      const grid = document.getElementById('dealsGrid'); grid.innerHTML='';
      const normalised = deals.map(d=> ({
        id: d.id || d.dealId || d.code || d,
        title: d.title || d.name || 'Deal',
        price: d.price || '‚Çπ0',
        note: d.note || d.discount || 'Great deal',
        img: d.img || 'https://images.unsplash.com/photo-1585386959984-a4155223f8a2?auto=format&fit=crop&w=1000&q=80'
      }));
      window.currentDeals = normalised;
      normalised.forEach(d=>{
        const card = document.createElement('div'); card.className='deal-card pop-in';
        card.innerHTML = `
          <div style="position:relative">
            <img src="${d.img}" alt="${d.title}" onerror="this.src='https://images.unsplash.com/photo-1585386959984-a4155223f8a2?auto=format&fit=crop&w=1000&q=80'">
            <button onclick="addToWishlist('${d.id}')" style="position:absolute;top:8px;right:8px;width:36px;height:36px;border-radius:50%;background:rgba(0,0,0,0.7);border:none;color:#fff;font-size:18px;cursor:pointer;backdrop-filter:blur(10px)" title="Add to Wishlist">‚ù§Ô∏è</button>
          </div>
          <h3>${d.title}</h3>
          <p class="muted">${d.note}</p>
          <div class="deal-actions">
            <div class="price">${d.price}</div>
            <div style="display:flex;gap:8px">
              <button class="btn-ghost" onclick="viewProduct('${d.id}')" style="flex:1">View</button>
              <button class="btn-accent" onclick="addToCartId('${d.id}', this)" style="flex:1">üõçÔ∏è Add</button>
            </div>
          </div>
          <button onclick="addToCompare('${d.id}')" style="width:100%;margin-top:8px;padding:8px;background:rgba(0,200,255,0.1);border:1px solid rgba(0,200,255,0.3);border-radius:8px;color:var(--accent);cursor:pointer;font-weight:600">‚öñÔ∏è Compare</button>
        `;
        grid.appendChild(card);
      });
    }

    // Attempt backend fetch else fallback
    async function loadDeals(){
      // If user clicked a category, use provided catalog (persisted by categories page)
      const lastCat = localStorage.getItem('dealwise_last_category');
      const catalogJSON = localStorage.getItem('dealwise_catalog');
      if (lastCat && catalogJSON) {
        const catalog = JSON.parse(catalogJSON);
        const items = (catalog[lastCat] || []).map((name, idx) => ({
          id: `${lastCat}-${idx+1}`,
          title: name,
          price: priceForTitle(name),
          note: 'Special price',
          img: getCategoryImage(lastCat)
        }));
        renderDeals(items);
        return;
      }
      try{
        const res = await fetch(API_BASE + '/deals');
        if(res.ok){
          const data = await res.json();
          if(Array.isArray(data) && data.length){
            const mapped = data.map(d=> ({ id: 'd'+(d.id||d.dealId||''), title: d.title, price: d.price, note: d.discount||'Great deal', img: d.imageUrl || 'assets/placeholder.svg' }));
            renderDeals(mapped);
            return;
          }
        }
      }catch(e){}
      // Default Top Deals: pick a few from each category (if available from catalog), else fallback
      try{
        const catalog = JSON.parse(localStorage.getItem('dealwise_catalog')||'{}');
        const order = ['electronics','fashion','home','fitness','gaming','beauty'];
        const mixed = [];
        order.forEach(key => {
          const list = catalog[key] || [];
          list.slice(0,4).forEach((name, i) => mixed.push({ id:`${key}-${i+1}`, title:name, price:priceForTitle(name), note:'Editor\'s pick', img:getCategoryImage(key) }));
        });
        if (mixed.length) { renderDeals(mixed); return; }
      }catch(e){}
      renderDeals(SAMPLE_DEALS);
    }

    // Price helper ‚Äî choose realistic ranges by item type
    function priceForTitle(name){
      const t = (name||'').toLowerCase();
      const n = (min,max) => Math.round(Math.random()*(max-min)+min);
      // Electronics
      if(t.includes('iphone') || t.includes('galaxy') || t.includes('phone')) return `‚Çπ${n(45000,120000).toLocaleString()}`;
      if(t.includes('macbook') || t.includes('xps') || t.includes('laptop')) return `‚Çπ${n(60000,180000).toLocaleString()}`;
      if(t.includes('tv')) return `‚Çπ${n(25000,90000).toLocaleString()}`;
      if(t.includes('ipad') || t.includes('tablet')) return `‚Çπ${n(30000,90000).toLocaleString()}`;
      if(t.includes('buds') || t.includes('headphone')) return `‚Çπ${n(2000,35000).toLocaleString()}`;
      if(t.includes('camera')) return `‚Çπ${n(40000,120000).toLocaleString()}`;
      if(t.includes('power') || t.includes('powerbank')) return `‚Çπ${n(1500,6000).toLocaleString()}`;
      if(t.includes('watch')) return `‚Çπ${n(3000,30000).toLocaleString()}`;
      // Fashion
      if(t.includes('jeans') || t.includes('overshirt') || t.includes('polo') || t.includes('shirt') || t.includes('pants') || t.includes('shorts') || t.includes('t-shirt') || t.includes('tee')) return `‚Çπ${n(799,3999).toLocaleString()}`;
      if(t.includes('sneaker') || t.includes('shoes') || t.includes('crocs')) return `‚Çπ${n(1999,9999).toLocaleString()}`;
      if(t.includes('watch')) return `‚Çπ${n(3999,19999).toLocaleString()}`;
      if(t.includes('sunglass')) return `‚Çπ${n(2999,14999).toLocaleString()}`;
      if(t.includes('handbag') || t.includes('blazer')) return `‚Çπ${n(4999,49999).toLocaleString()}`;
      // Home & Kitchen
      if(t.includes('air fryer')) return `‚Çπ${n(4999,14999).toLocaleString()}`;
      if(t.includes('mixer') || t.includes('grinder') || t.includes('cookware') || t.includes('kettle') || t.includes('pan') || t.includes('pressure cooker')) return `‚Çπ${n(999,6999).toLocaleString()}`;
      if(t.includes('vacuum') || t.includes('heater') || t.includes('ceiling fan')) return `‚Çπ${n(2999,24999).toLocaleString()}`;
      if(t.includes('pillow') || t.includes('bottle') || t.includes('storage') || t.includes('lamp') || t.includes('lunchbox')) return `‚Çπ${n(399,2999).toLocaleString()}`;
      // Fitness
      if(t.includes('yoga') || t.includes('rope') || t.includes('bands') || t.includes('gloves')) return `‚Çπ${n(299,1999).toLocaleString()}`;
      if(t.includes('treadmill') || t.includes('exercise bike')) return `‚Çπ${n(12000,65000).toLocaleString()}`;
      if(t.includes('protein') || t.includes('peanut butter')) return `‚Çπ${n(399,2999).toLocaleString()}`;
      if(t.includes('fitbit') || t.includes('fitness tracker')) return `‚Çπ${n(3999,19999).toLocaleString()}`;
      // Gaming
      if(t.includes('playstation') || t.includes('xbox') || t.includes('switch') || t.includes('steam deck')) return `‚Çπ${n(25000,80000).toLocaleString()}`;
      if(t.includes('gaming laptop')) return `‚Çπ${n(70000,200000).toLocaleString()}`;
      if(t.includes('monitor')) return `‚Çπ${n(12000,45000).toLocaleString()}`;
      if(t.includes('keyboard') || t.includes('mouse') || t.includes('headset') || t.includes('controller') || t.includes('capture')) return `‚Çπ${n(1499,14999).toLocaleString()}`;
      if(t.includes('chair')) return `‚Çπ${n(6999,29999).toLocaleString()}`;
      // Beauty
      if(t.includes('serum') || t.includes('moisturizer') || t.includes('foundation') || t.includes('toner') || t.includes('lip') || t.includes('kajal') || t.includes('wash') || t.includes('lotion') || t.includes('oil')) return `‚Çπ${n(199,2499).toLocaleString()}`;
      if(t.includes('hair straightener')) return `‚Çπ${n(1499,5999).toLocaleString()}`;
      // default
      return `‚Çπ${n(999,9999).toLocaleString()}`;
    }

    // nav actions
    document.getElementById('loginBtn')?.addEventListener('click', ()=> location.href='login.html');
    document.getElementById('signupBtn')?.addEventListener('click', ()=> location.href='signup.html');
    document.getElementById('cartButton')?.addEventListener('click', ()=> location.href='cart.html');

    document.addEventListener('DOMContentLoaded', ()=>{ 
      // use global cart system for count
      if (window.dealwiseCart) { window.dealwiseCart.updateCartCount(); }
      loadDeals(); 
    });
    window.addToCartId = addToCartId;
    
    function viewProduct(id) {
      try{
        const item = (window.currentDeals||[]).find(x=>String(x.id)===String(id));
        if(item){ localStorage.setItem('dealwise_view_item', JSON.stringify(item)); }
      }catch(e){}
      window.location.href = `product-detail.html?id=${id}`;
    }
    window.viewProduct = viewProduct;
    
    // Wishlist function
    function addToWishlist(id) {
      const item = (window.currentDeals||[]).find(x=>String(x.id)===String(id));
      if (item && window.DealWiseWishlist) {
        window.DealWiseWishlist.add(item);
      } else {
        alert('Added to wishlist! ‚ù§Ô∏è');
      }
    }
    window.addToWishlist = addToWishlist;
    
    // Compare function
    function addToCompare(id) {
      const item = (window.currentDeals||[]).find(x=>String(x.id)===String(id));
      if (item && window.DealWiseCompare) {
        window.DealWiseCompare.add(item);
      } else {
        alert('Added to comparison! ‚öñÔ∏è');
      }
    }
    window.addToCompare = addToCompare;
  </script>

  <footer class="mt-20 bg-[#111827] py-8 text-center">
  <p class="text-[#00bcd4] mb-3 font-semibold">Contact us: support@dealwise.com | +91 98765 43210</p>
  <div class="flex justify-center space-x-6">
    <a href="#" class="hover:text-[#00bcd4]">Instagram</a>
    <a href="#" class="hover:text-[#00bcd4]">Twitter</a>
    <a href="#" class="hover:text-[#00bcd4]">LinkedIn</a>
  </div>
  <p class="mt-4 text-gray-500 text-sm">¬© 2025 DealWise. All Rights Reserved.</p>
</footer>

</body>
</html>
